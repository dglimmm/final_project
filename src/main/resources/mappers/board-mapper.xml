<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">
	<resultMap type="Board" id="boardResult">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="BOARD_CONTENT" property="boardContent"/>
		<result column="BOARD_CREATE_DATE" property="boardCreateDate"/>
		<result column="BOARD_MODIFY_DATE" property="boardModifyDate"/>
		<result column="BOARD_REPORT" property="boardReport"/>
		<result column="BOARD_WRITER" property="boardWriter"/>
		<result column="MEMBER_ID" property="boardWriter"/>
		<result column="BOARD_TRIP_PLAN_NO" property="boardTripPlanNo"/>
		<result column="BOARD_CATEGORY" property="boardCategory"/>
		<result column="TRIP_PLAN_THUMBNAIL" property="tripPlanThumbnail"/>
		<result column="ATTACHMENT_CHANGE_NAME" property="attachement"/>
		<result column="TRIP_START_DATE" property="tripStartDate"/>
		<result column="TRIP_END_DATE" property="tripEndDate"/>
		<result column="BOARD_REGION_NO" property="boardRegionNo"/>

	</resultMap>
		<resultMap type="Plan" id="planResult">
		<result column="TRIP_PLAN_NO" property="tripPlanNo"/>
		<result column="TRIP_PLANNER_NO" property="tripPlannerNo"/>
		<result column="TRIP_PLAN_TITLE" property="tripPlanTitle"/>
		<result column="TRIP_START_DATE" property="tripStartDate"/>
		<result column="TRIP_END_DATE" property="tripEndDate"/>
		<result column="TRANSPORTATION_NO" property="transportationNo"/>
		<result column="LOCATION_NO" property="locationNo"/>
		<result column="TRIP_PLAN_THUMBNAIL" property="tripPlanThumbnail"/>
		<result column="ATTRACTION_NO" property="attractionNo"/>
		<result column="ATTRACTION_NAME" property="attractionName"/>
		<result column="ATTRACTION_CHANGE_NAME_IMG" property="attractionChangeNameImg"/>
		<result column="REGION_NO" property="regionNo"/>
		<result column="REGION_NAME" property="regionName"/>
		<result column="TRIP_N_DAY" property="tripNday"/>
	</resultMap>
				
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 같이가요 게시글의 총 갯수 조회하는 쿼리문 -->
	<select id="selectTogetherListCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		WHERE BOARD_CATEGORY = 2
		AND BOARD_STATUS = 'Y'
	</select>
	
	<!-- 같이가요 게시글 조회 쿼리문 -->
	<select id="selectTogetherList" resultMap="boardResult">
 		select  BOARD_NO
				,BOARD_TITLE
		        ,BOARD_CONTENT
		        ,MEMBER_ID
				,TO_CHAR(BOARD_CREATE_DATE, 'YYYY/MM/DD') AS "BOARD_CREATE_DATE"
                ,TRIP_PLAN_THUMBNAIL
		from board
		join member on (BOARD_WRITER = MEMBER_NO)
        join TRIP_PLAN on (BOARD_TRIP_PLAN_NO = TRIP_PLAN_NO)
		where BOARD_CATEGORY = 2
		AND BOARD_STATUS = 'Y'
		ORDER BY BOARD_CREATE_DATE DESC
	</select>
	
	<!-- 같이가요 게시글 키워드 검색 쿼리문 -->
	<select id="togetherSearchList" resultMap="boardResult">
		select  B.BOARD_NO
				,B.BOARD_TITLE
		        ,B.BOARD_CONTENT
		        ,M.MEMBER_ID
		        ,TO_CHAR(B.BOARD_CREATE_DATE, 'YYYY/MM/DD') AS "BOARD_CREATE_DATE"
		        ,T.TRIP_PLAN_THUMBNAIL
		from board B
		join member M on (B.BOARD_WRITER = M.MEMBER_NO)
		join TRIP_PLAN T on (B.BOARD_TRIP_PLAN_NO = T.TRIP_PLAN_NO)
		join REGION R on (R.REGION_NO = B.BOARD_REGION_NO)
		where B.BOARD_CATEGORY = 2
		AND B.BOARD_STATUS = 'Y'
		<choose>
			<when test="condition == 'writer'">
	  		AND M.MEMBER_ID 
	  		</when>
	  		<when test="condition == 'title'">
	        AND B.BOARD_TITLE LIKE '%' || #{keyword} || '%' 
	        </when>
	        <when test="condition == 'region'">
	        AND R.REGION_NAME
	        </when>
	        <otherwise>
	        AND B.BOARD_CONTENT
      	 	</otherwise>
        </choose>
        LIKE '%' || #{keyword} || '%'
        ORDER BY B.BOARD_NO DESC
	</select>
	
	<!-- 글쓰기 누르면 ajax 로 가져올 일정호출 -->
	<select id="selectPlanList" resultMap="planResult">
 		select  TRIP_PLAN_NO
				,TRIP_PLAN_TITLE
		        ,TO_CHAR(TRIP_START_DATE, 'YYYY/MM/DD') AS "TRIP_START_DATE"
		        ,TO_CHAR(TRIP_END_DATE, 'YYYY/MM/DD') AS "TRIP_END_DATE"
                ,LOCATION_NO
                ,TRIP_PLAN_THUMBNAIL
                ,ATTRACTION_NO
                ,ATTRACTION_NAME
                ,ATTRACTION_CHANGE_NAME_IMG
                ,REGION_NO
                ,REGION_NAME
                ,TRIP_N_DAY
		from TRIP_PLAN
		join member on (TRIP_PLANNER_NO = MEMBER_NO)
        join location using (TRIP_PLAN_NO)
        join ATTRACTION on (LOCATION_ATTRACTION_NO = ATTRACTION_NO)
        join REGION on(ATTRACTION_REGION_NO =REGION_NO)
		where TRIP_PLANNER_NO = #{memberNo}
	</select>
	
	<!-- plan 정보가지고 글쓰기 페이지에 가져오기 -->
	<select id="selectOneTripPlan" resultMap="planResult">
 		        select  TRIP_PLAN_NO
				,TRIP_PLAN_TITLE
                ,LOCATION_NO
                ,TRIP_PLAN_THUMBNAIL
                ,ATTRACTION_NO
                ,ATTRACTION_NAME
                ,ATTRACTION_X
                ,ATTRACTION_Y
                ,ATTRACTION_CHANGE_NAME_IMG
                ,TRIP_N_DAY
                ,REGION_NO
		from TRIP_PLAN
		join member on (TRIP_PLANNER_NO = MEMBER_NO)
        join location using (TRIP_PLAN_NO)
        join ATTRACTION on (LOCATION_ATTRACTION_NO = ATTRACTION_NO)
        join REGION on (REGION_NO = ATTRACTION_REGION_NO)
		where TRIP_PLAN_NO = #{tripPlanNo}
	</select>
	
	<!-- plan max day 조회하는 쿼리문 -->
	<select id="countMaxPlanDay" resultType="_int">
		select  MAX(TRIP_N_DAY)
		from TRIP_PLAN
        join location using (TRIP_PLAN_NO)
		where TRIP_PLAN_NO = #{tripPlanNo}
        ORDER BY TRIP_N_DAY
	</select>
	
	<!-- 같이가요 게시글 작성 쿼리문 -->
	<insert id="insertTogetherBoard">
		INSERT INTO BOARD 
				(BOARD_NO
				,BOARD_TITLE
                ,BOARD_CONTENT
				,BOARD_WRITER
				,BOARD_TRIP_PLAN_NO
                ,BOARD_CATEGORY
                ,BOARD_REGION_NO
				)
		VALUES (SEQ_BNO.NEXTVAL
				,#{boardTitle}
				,#{boardContent}
				,#{boardWriter}
				,#{boardTripPlanNo}
                ,2
                ,#{boardRegionNo}
							)
		</insert>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 후기 게시글의 총 갯수 조회하는 쿼리문 -->
	<select id="selectReviewListCount" resultType="_int">
	
		SELECT COUNT(*)
		FROM BOARD
		WHERE BOARD_CATEGORY = 1
		
	</select>
	
	<!-- 후기 게시글 조회 쿼리문 -->
	<select id="selectReviewList" resultMap="boardResult">
	    SELECT 	BOARD_NO,
		      	BOARD_TITLE,
		       	BOARD_WRITER,
		       	TO_CHAR(BOARD_CREATE_DATE, 'YYYY-MM-DD') AS "BOARD_CREATE_DATE"
		FROM   	BOARD
		
		JOIN MEMBER ON (BOARD_WRITER = MEMBER_NO)
		
		WHERE  	BOARD_STATUS = 'Y'
		AND		BOARD_CATEGORY = 1
		ORDER  	BY BOARD_NO DESC
		
	</select>
	
	
	
	<select id="selectListBoard" resultMap="boardResult"> <!-- 객체여서 MAP -->
		
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 마이페이지 같이가요 게시글의 총 갯수 조회하는 쿼리문 -->
	<select id="myTogetherListCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		JOIN MEMBER ON (MEMBER_NO = BOARD_WRITER)
		JOIN TRIP_PLAN ON (TRIP_PLAN_NO = BOARD_TRIP_PLAN_NO)
		WHERE BOARD_CATEGORY = 2
			AND BOARD_WRITER = #{memberNo}
	</select>
	
	<!-- 마이페이지 같이가요 게시글 조회 쿼리문 -->
	<select id="myTogetherList" resultMap="boardResult">
		select  BOARD_NO
				,BOARD_TITLE
		        ,BOARD_CONTENT
		        ,BOARD_WRITER
		        ,BOARD_MODIFY_DATE      
		        ,TRIP_START_DATE
		        ,TRIP_END_DATE
		from board
		join member on (BOARD_WRITER = MEMBER_NO)
		JOIN TRIP_PLAN ON(BOARD_TRIP_PLAN_NO = TRIP_PLAN_NO)
		where BOARD_CATEGORY = 2
			AND BOARD_WRITER = #{memberNo}
		ORDER BY BOARD_NO DESC

	</select>
	
	
	
	
	<!-- 마이페이지 후기 게시글의 총 갯수 조회하는 쿼리문 -->
	<select id="myReviewListCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		JOIN MEMBER ON (MEMBER_NO = BOARD_WRITER)
		JOIN TRIP_PLAN ON (TRIP_PLAN_NO = BOARD_TRIP_PLAN_NO)
		WHERE BOARD_CATEGORY = 1
			AND BOARD_WRITER = #{memberNo}
	</select>
	
	<!-- 마이페이지 후기 게시글 조회 쿼리문 -->
	<select id="myReviewList" resultMap="boardResult">
		select  BOARD_NO
				,BOARD_TITLE
		        ,BOARD_CONTENT
		        ,BOARD_WRITER
		        ,BOARD_MODIFY_DATE       
		        ,TRIP_START_DATE
		        ,TRIP_END_DATE
		from board
		join member on (BOARD_WRITER = MEMBER_NO)
		JOIN TRIP_PLAN ON(BOARD_TRIP_PLAN_NO = TRIP_PLAN_NO)
		where BOARD_CATEGORY = 1
			AND BOARD_WRITER = #{memberNo}
		ORDER BY BOARD_NO DESC

	</select>
	
	
</mapper>
